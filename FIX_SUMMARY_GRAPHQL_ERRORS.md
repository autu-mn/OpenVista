# GraphQL é”™è¯¯ä¿®å¤æ€»ç»“

## ğŸ› å‘ç°çš„é—®é¢˜

### 1. **Resource limits for this query exceeded** (æœ€ä¸¥é‡)
- GraphQL æŸ¥è¯¢æ¯æ¬¡è¯·æ±‚ 100 ä¸ª items
- è¶…è¿‡ GitHub çš„å•æ¬¡æŸ¥è¯¢èµ„æºé™åˆ¶
- å¯¼è‡´è¯·æ±‚å¤±è´¥

### 2. **API rate limit already exceeded for user ID 181187014**
- æ‰€æœ‰ 7 ä¸ª tokens éƒ½å±äºåŒä¸€è´¦æˆ·
- å…±äº«åŒä¸€ä¸ª rate limitï¼ˆ5000 ç‚¹/å°æ—¶ï¼‰
- å¿«é€Ÿè€—å°½é…é¢

### 3. **cannot access local variable 'time' where it is not associated with a value**
- `time` æ¨¡å—æ²¡æœ‰åœ¨æ–‡ä»¶é¡¶éƒ¨å¯¼å…¥
- åœ¨åµŒå¥—ä»£ç å—ä¸­æ‰ `import time`
- å¯¼è‡´åœ¨ä½¿ç”¨ `time.time()` æ—¶æŠ¥é”™

---

## âœ… å·²å®æ–½çš„ä¿®å¤

### ä¿®å¤ 1: å¯¼å…¥ time æ¨¡å—

**æ–‡ä»¶**: `backend/DataProcessor/github_graphql_crawler.py`

```python
# ä¿®å¤å‰
import os
import requests
import json
# ... (æ²¡æœ‰ time)

# ä¿®å¤å
import os
import requests
import json
import time  # âœ… æ·»åŠ 
```

**æ•ˆæœ**: è§£å†³ "cannot access local variable 'time'" é”™è¯¯

---

### ä¿®å¤ 2: å‡å°‘ GraphQL æŸ¥è¯¢é‡

**æ–‡ä»¶**: `backend/DataProcessor/github_graphql_crawler.py`

#### Issues æŸ¥è¯¢
```python
# ä¿®å¤å‰
issues(
  first: 100  # æ¯æ¬¡æŸ¥è¯¢ 100 ä¸ª
  ...
)

# ä¿®å¤å
issues(
  first: 20   # æ¯æ¬¡æŸ¥è¯¢ 20 ä¸ª âœ…
  ...
)
```

#### Pull Requests æŸ¥è¯¢
```python
# ä¿®å¤å‰
pullRequests(
  first: 100
  ...
)

# ä¿®å¤å
pullRequests(
  first: 20  # âœ…
  ...
)
```

#### Commits æŸ¥è¯¢
```python
# ä¿®å¤å‰
history(first: 100, after: $after)

# ä¿®å¤å
history(first: 20, after: $after)  # âœ…
```

#### Releases æŸ¥è¯¢
```python
# ä¿®å¤å‰
releases(first: 100, ...)

# ä¿®å¤å
releases(first: 20, ...)  # âœ…
```

**æ•ˆæœ**: 
- âœ… é¿å… "Resource limits exceeded" é”™è¯¯
- âœ… å•æ¬¡æŸ¥è¯¢æ¶ˆè€—ç‚¹æ•°å‡å°‘ 80%
- âš ï¸ éœ€è¦æ›´å¤šæ¬¡è¯·æ±‚æ¥è·å–ç›¸åŒæ•°æ®é‡

---

### ä¿®å¤ 3: åˆ›å»ºéªŒè¯å·¥å…·

**æ–‡ä»¶**: `backend/verify_tokens.py`

**åŠŸèƒ½**:
- æ£€æŸ¥æ‰€æœ‰ GitHub tokens
- æ˜¾ç¤ºç”¨æˆ·åå’Œç”¨æˆ· ID
- æ˜¾ç¤º REST å’Œ GraphQL çš„å‰©ä½™é…é¢
- æ£€æµ‹ tokens æ˜¯å¦æ¥è‡ªåŒä¸€è´¦æˆ·
- æä¾›è¯¦ç»†çš„åˆ†ææŠ¥å‘Š

**ä½¿ç”¨æ–¹æ³•**:
```bash
cd backend
python verify_tokens.py
```

**è¾“å‡ºç¤ºä¾‹**:
```
âœ… æ‰¾åˆ° 7 ä¸ª tokens

ğŸ“‹ Tokens æ±‡æ€»è¡¨:
+----------------+------------+-----------+---------------------+---------------------+
| Token åç§°     | ç”¨æˆ·å     | ç”¨æˆ· ID   | REST API å‰©ä½™       | GraphQL å‰©ä½™        |
+----------------+------------+-----------+---------------------+---------------------+
| GITHUB_TOKEN   | user1      | 12345     | 4850/5000 (97.0%)   | 4900/5000 (98.0%)   |
| GITHUB_TOKEN_1 | user1      | 12345     | 4850/5000 (97.0%)   | 4900/5000 (98.0%)   |
+----------------+------------+-----------+---------------------+---------------------+

ğŸ” åˆ†æç»“æœ:
âš ï¸  è­¦å‘Š: æ‰€æœ‰ 2 ä¸ª tokens éƒ½æ¥è‡ªåŒä¸€ä¸ªè´¦æˆ·!
   ç”¨æˆ· ID: 12345
```

---

## ğŸ“Š ä¿®å¤æ•ˆæœå¯¹æ¯”

### GraphQL ç‚¹æ•°æ¶ˆè€—

å‡è®¾çˆ¬å– 1 ä¸ªæœˆçš„æ•°æ®ï¼ˆæ¯ä¸ªæœˆ 3 æ¡ï¼‰ï¼š

| æ•°æ®ç±»å‹ | ä¿®å¤å‰ | ä¿®å¤å | èŠ‚çœ |
|---------|--------|--------|------|
| Issues (3æ¡) | ~100 ç‚¹ | ~20 ç‚¹ | 80% |
| PRs (3æ¡) | ~100 ç‚¹ | ~20 ç‚¹ | 80% |
| Commits (3æ¡) | ~100 ç‚¹ | ~20 ç‚¹ | 80% |
| Releases (3æ¡) | ~100 ç‚¹ | ~20 ç‚¹ | 80% |
| **æ¯æœˆæ€»è®¡** | **~400 ç‚¹** | **~80 ç‚¹** | **80%** |

**çˆ¬å– 113 ä¸ªæœˆçš„é¡¹ç›®**:
- ä¿®å¤å‰: 113 Ã— 400 = 45,200 ç‚¹ âŒ è¶…é™
- ä¿®å¤å: 113 Ã— 80 = 9,040 ç‚¹ âœ… å¯è¡Œï¼ˆä½¿ç”¨ 2 ä¸ªä¸åŒè´¦æˆ·ï¼‰

---

## âš ï¸ ä»éœ€è§£å†³çš„é—®é¢˜

### é—®é¢˜: Tokens æ¥è‡ªåŒä¸€è´¦æˆ·

**ç°çŠ¶**: æ‰€æœ‰ tokens æ˜¾ç¤ºç›¸åŒçš„ç”¨æˆ· ID (181187014)

**å½±å“**:
- æ‰€æœ‰ tokens å…±äº« 5000 ç‚¹/å°æ—¶çš„é…é¢
- æ— æ³•é€šè¿‡æ·»åŠ  tokens æé«˜é€Ÿåº¦
- ä»ç„¶å®¹æ˜“è§¦å‘ rate limit

**è§£å†³æ–¹æ¡ˆ**:
1. **åˆ›å»ºå¤šä¸ª GitHub è´¦æˆ·**ï¼ˆæ¨èï¼‰
   - ä½¿ç”¨ä¸åŒé‚®ç®±æ³¨å†Œ 6 ä¸ªæ–°è´¦æˆ·
   - ä¸ºæ¯ä¸ªè´¦æˆ·ç”Ÿæˆ token
   - æ›´æ–° `.env` æ–‡ä»¶

2. **ä½¿ç”¨å›¢é˜Ÿæˆå‘˜çš„è´¦æˆ·**
   - è¯·æ±‚å›¢é˜Ÿæˆå‘˜æä¾› tokens
   - ç¡®ä¿ä»–ä»¬æœ‰ä»“åº“è®¿é—®æƒé™

3. **ä½¿ç”¨ GitHub App**ï¼ˆé«˜çº§ï¼‰
   - åˆ›å»º GitHub App
   - è·å–æ›´é«˜çš„ rate limit

---

## ğŸš€ ä½¿ç”¨å»ºè®®

### 1. ç«‹å³è¿è¡ŒéªŒè¯è„šæœ¬
```bash
cd backend
python verify_tokens.py
```

### 2. æ£€æŸ¥è¾“å‡º
- å¦‚æœçœ‹åˆ° "âš ï¸ æ‰€æœ‰ tokens éƒ½æ¥è‡ªåŒä¸€ä¸ªè´¦æˆ·"
  - ä½ éœ€è¦åˆ›å»ºæ–°çš„ GitHub è´¦æˆ·
  - å‚è€ƒ `CRITICAL_RATE_LIMIT_WARNING.md`

- å¦‚æœçœ‹åˆ° "âœ… ä½ æœ‰ X ä¸ªä¸åŒè´¦æˆ·çš„ tokens"
  - å¤ªå¥½äº†ï¼ä½ å¯ä»¥å¼€å§‹çˆ¬å–äº†
  - Rate limit æ˜¯å•ä¸ªè´¦æˆ·çš„ X å€

### 3. å¼€å§‹çˆ¬å–
ç­‰å¾…å½“å‰çš„ rate limit é‡ç½®ï¼ˆ48 åˆ†é’Ÿï¼‰ï¼Œç„¶åï¼š
```bash
# å¯åŠ¨åç«¯
cd backend
python app.py

# åœ¨å‰ç«¯å¼€å§‹çˆ¬å–é¡¹ç›®
```

---

## ğŸ“ˆ é¢„æœŸæ”¹è¿›

### ä¿®å¤å‰
- âŒ "Resource limits exceeded" é”™è¯¯é¢‘ç¹
- âŒ æ¯æ¬¡æŸ¥è¯¢æ¶ˆè€— 100 ç‚¹
- âŒ å¿«é€Ÿè€—å°½ rate limit
- âŒ éœ€è¦ç­‰å¾… 1 å°æ—¶æ‰èƒ½ç»§ç»­

### ä¿®å¤å
- âœ… é¿å…èµ„æºé™åˆ¶é”™è¯¯
- âœ… æ¯æ¬¡æŸ¥è¯¢åªæ¶ˆè€— 20 ç‚¹
- âœ… Rate limit ä½¿ç”¨æ›´é«˜æ•ˆ
- âœ… å¯ä»¥çˆ¬å–æ›´å¤šæ•°æ®

### ä½¿ç”¨ä¸åŒè´¦æˆ·çš„ Tokens å
- âœ…âœ… Rate limit æå‡ 7 å€ï¼ˆ35,000 ç‚¹/å°æ—¶ï¼‰
- âœ…âœ… å¯ä»¥å¹¶å‘çˆ¬å–
- âœ…âœ… å‡ ä¹ä¸ä¼šé‡åˆ° rate limit é—®é¢˜

---

## ğŸ“ æ£€æŸ¥æ¸…å•

- [x] ä¿®å¤ `time` æ¨¡å—å¯¼å…¥é”™è¯¯
- [x] å‡å°‘ GraphQL æŸ¥è¯¢é‡ï¼ˆ100 â†’ 20ï¼‰
- [x] åˆ›å»º tokens éªŒè¯å·¥å…·
- [x] åˆ›å»ºè¯¦ç»†æ–‡æ¡£
- [ ] **è¿è¡Œ `verify_tokens.py` æ£€æŸ¥ tokens**
- [ ] **å¦‚æœéœ€è¦ï¼Œåˆ›å»ºæ–°çš„ GitHub è´¦æˆ·**
- [ ] **æ›´æ–° `.env` æ–‡ä»¶**
- [ ] **å†æ¬¡è¿è¡ŒéªŒè¯è„šæœ¬ç¡®è®¤**
- [ ] **ç­‰å¾… rate limit é‡ç½®**
- [ ] **å¼€å§‹çˆ¬å–æµ‹è¯•**

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- `CRITICAL_RATE_LIMIT_WARNING.md` - è¯¦ç»†çš„ Rate Limit è¯´æ˜
- `backend/verify_tokens.py` - Token éªŒè¯å·¥å…·
- `OPENDIGGER_DISPLAY_FIX.md` - OpenDigger æ˜¾ç¤ºé—®é¢˜ä¿®å¤
- `OPENDIGGER_FINAL_REPORT.md` - å®Œæ•´åŠŸèƒ½æŠ¥å‘Š

---

**ä¿®å¤æ—¶é—´**: 2025-12-13
**çŠ¶æ€**: âœ… ä»£ç å·²ä¿®å¤ï¼Œç­‰å¾…éªŒè¯ Tokens




