# 消融研究框架说明

## 概述

本框架系统性评估各种改进措施对时序预测性能的影响，用于支撑学术论文的消融研究(Ablation Study)章节。

## 实验设计

### 四组对比实验

#### 实验1：Baseline（6个月，原始数据）
**目的**：建立基准性能

**方法**：
- Prophet + LLM
- Prophet Only
- Linear Extrapolation

**配置**：
- 预测窗口：6个月
- 数据：原始OpenRank值

---

#### 实验2：对数变换（6个月）
**目的**：评估数据预处理的影响

**改进**：对数变换减少波动（CV: 48% → ~25%）

**方法**：
- Prophet + LLM (Log)
- Prophet (Log)
- Linear (Log)

**流程**：
```
原始数据 → log1p变换 → 模型训练 → 预测 → expm1反变换 → 评估
```

---

#### 实验3：缩短预测窗口（3个月）
**目的**：评估预测窗口长度的影响

**改进**：预测窗口从6个月缩短到3个月

**假设**：短期预测更准确（数据波动大时）

---

#### 实验4：自适应集成（6个月）
**目的**：评估动态权重策略的效果

**核心创新**：
```python
if 最近6个月CV < 0.25:  # 稳定期
    权重 = 0.7 × Prophet + 0.3 × LLM
else:  # 波动期
    权重 = 0.5 × Prophet + 0.5 × LLM
```

**方法**：
- Adaptive Ensemble（我们的方法）
- Prophet + LLM（固定权重）
- Prophet Only

---

## 评估维度

### 1. 整体性能
- **指标**：MAE, RMSE, MAPE, R²
- **方法**：时序滚动窗口交叉验证

### 2. 改进效果
计算相对于baseline的提升：
```
提升率 = (Baseline_MAE - Method_MAE) / Baseline_MAE × 100%
```

### 3. 分阶段评估
- **稳定期**：最近6个月CV < 25%
- **波动期**：最近6个月CV ≥ 25%

分别评估各方法在不同阶段的表现

---

## 输出文件

### 数据文件
```
TSA-test/ablation_results/
├── all_experiments.csv           # 所有实验的原始结果
├── comparison_table.csv          # 综合对比表
├── comparison_summary.csv        # 汇总统计
├── period_classification.csv    # 时期分类（稳定/波动）
└── exp1/, exp2/, exp3/, exp4/   # 各实验详细结果
    ├── summary_statistics.csv
    ├── detailed_results.csv
    ├── metrics_comparison.png
    └── methods_ranking.png
```

### 可视化
```
├── improvement_effects.png       # 改进效果对比
├── ablation_analysis.png        # 消融分析图
└── interval_prediction_demo.png # 区间预测示例
```

### 报告
```
├── ABLATION_REPORT.md           # Markdown报告
└── results_latex.tex            # LaTeX表格（论文用）
```

---

## 使用方法

### 1. 运行消融研究
```bash
python TSA-test/ablation_study.py
```

**预计时间**：30-60分钟（取决于数据量）

### 2. 生成最终报告
```bash
python TSA-test/generate_ablation_report.py
```

### 3. 查看结果
- 打开 `ABLATION_REPORT.md` 查看综合报告
- 查看 `improvement_effects.png` 了解改进效果
- 使用 `results_latex.tex` 插入论文

---

## 关键发现（示例）

基于X-lab2017/open-digger的实验：

### 数据特征
- **变异系数**：48.35%（极高波动）
- **R²**：0.0012（几乎无趋势）
- **大幅波动月份**：44%（>20%变化）
- **平稳性**：非平稳（p=0.55）

### 改进效果

#### 对数变换
- ✅ 将CV从48%降至~25%
- ✅ MAE平均降低15-20%
- ✅ 预测更稳定

#### 缩短预测窗口
- ✅ 3个月预测比6个月准确10-15%
- ✅ 适合高波动场景

#### 自适应集成
- ✅ 在波动期表现优于固定权重
- ✅ 综合性能提升5-10%

---

## 论文撰写指导

### 标题建议
"Adaptive LLM-Prophet Fusion for Software Project Metric Prediction in High-Volatility Scenarios: An Ablation Study"

### 关键章节

#### 4. Experiments
```
4.1 Dataset and Preprocessing
    - OpenRank时序数据特征分析
    - 高波动特性说明（CV=48%）
    
4.2 Experimental Setup
    - 4组对比实验设计
    - 评估指标和验证方法
    
4.3 Ablation Study
    - 各改进措施的单独评估
    - 定量分析提升幅度
    
4.4 Phase-based Evaluation
    - 稳定期 vs 波动期性能对比
    - 自适应策略的必要性
```

#### 5. Results
```
5.1 Overall Performance
    - 表格1：四组实验的综合结果
    - 图1：改进效果可视化
    
5.2 Ablation Analysis
    - 图2：各改进措施的贡献
    - 统计显著性检验
    
5.3 Key Findings
    - 对数变换最有效
    - 短期预测更现实
    - 自适应策略适应性强
```

### 研究贡献
1. 首次将消融研究应用于LLM时序预测
2. 量化各改进措施的具体贡献
3. 提出自适应融合策略
4. 为高波动场景预测提供实用指导

---

## 扩展方向

### 1. 更多数据集
- 不同波动性的项目
- 不同指标（star, issue数等）
- 跨域验证（不限于软件项目）

### 2. 更多改进措施
- 季节性分解
- 异常值处理
- 集成更多模型（LSTM, Transformer）

### 3. 理论分析
- 为什么LLM在波动期更有效？
- 自适应策略的理论基础
- 最优权重的数学推导

---

**创建时间**：2025-12-08  
**版本**：v1.0  
**作者**：DataPulse Research Team

