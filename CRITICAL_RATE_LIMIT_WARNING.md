# âš ï¸ ä¸¥é‡é—®é¢˜ï¼šGitHub Token Rate Limit

## ğŸš¨ å½“å‰é—®é¢˜

æ ¹æ®åç«¯æ—¥å¿—ï¼Œ**æ‰€æœ‰ 7 ä¸ª GitHub Token éƒ½å±äºåŒä¸€ä¸ªç”¨æˆ·è´¦æˆ·**ï¼ˆUser ID: 181187014ï¼‰ã€‚

```
âš  GraphQLé”™è¯¯: API rate limit already exceeded for user ID 181187014.
```

### è¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿ

GitHub çš„ rate limit æ˜¯**æŒ‰è´¦æˆ·**è®¡ç®—çš„ï¼Œä¸æ˜¯æŒ‰ token è®¡ç®—çš„ï¼š
- 1ä¸ªè´¦æˆ· = 5000æ¬¡è¯·æ±‚/å°æ—¶ï¼ˆREST APIï¼‰æˆ– 5000ç‚¹æ•°/å°æ—¶ï¼ˆGraphQL APIï¼‰
- **åŒä¸€è´¦æˆ·çš„å¤šä¸ª token å…±äº«åŒä¸€ä¸ªé…é¢**
- ä½ çš„ 7 ä¸ª token å®é™…ä¸Šåªæœ‰ 1 ä¸ªè´¦æˆ·çš„é…é¢

### ä¸ºä»€ä¹ˆä¼šè¶…é™ï¼Ÿ

1. **GraphQL æŸ¥è¯¢è¿‡å¤§** - æ¯æ¬¡æŸ¥è¯¢100ä¸ªitemsï¼Œæ¶ˆè€—å¤§é‡ç‚¹æ•°
2. **å¹¶å‘è¯·æ±‚è¿‡å¤š** - å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯·æ±‚ï¼Œå¿«é€Ÿè€—å°½é…é¢
3. **Token æ— æ•ˆ** - æ‰€æœ‰ token éƒ½æ¥è‡ªåŒä¸€è´¦æˆ·ï¼Œæ²¡æœ‰å®ç°çœŸæ­£çš„è½®æ¢

---

## âœ… å·²å®æ–½çš„ç´§æ€¥ä¿®å¤

### 1. ä¿®å¤ä»£ç é”™è¯¯
**é—®é¢˜**: `cannot access local variable 'time' where it is not associated with a value`
**ä¿®å¤**: åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ  `import time`

### 2. å‡å°‘ GraphQL æŸ¥è¯¢é‡
**ä¿®æ”¹å‰**: æ¯æ¬¡æŸ¥è¯¢ 100 ä¸ª items
**ä¿®æ”¹å**: æ¯æ¬¡æŸ¥è¯¢ 20 ä¸ª items

| æ•°æ®ç±»å‹ | ä¿®æ”¹å‰ | ä¿®æ”¹å | å‡å°‘ |
|---------|--------|--------|------|
| Issues | `first: 100` | `first: 20` | 80% |
| Pull Requests | `first: 100` | `first: 20` | 80% |
| Commits | `first: 100` | `first: 20` | 80% |
| Releases | `first: 100` | `first: 20` | 80% |

**æ•ˆæœ**:
- âœ… å‡å°‘å•æ¬¡è¯·æ±‚æ¶ˆè€—çš„ç‚¹æ•°ï¼ˆä» ~100 ç‚¹é™åˆ° ~20 ç‚¹ï¼‰
- âœ… é¿å… "Resource limits for this query exceeded" é”™è¯¯
- âš ï¸ éœ€è¦æ›´å¤šæ¬¡è¯·æ±‚æ‰èƒ½è·å–ç›¸åŒæ•°é‡çš„æ•°æ®

### 3. ä¼˜åŒ–å¹¶å‘é‡ï¼ˆä¹‹å‰å·²å®Œæˆï¼‰
- æœˆä»½å¹¶å‘: 5 â†’ 2
- GraphQL å¹¶å‘: 4 â†’ 2

---

## âš ï¸ æ ¹æœ¬è§£å†³æ–¹æ¡ˆ

### ä½ å¿…é¡»åšçš„äº‹æƒ…ï¼šä½¿ç”¨ä¸åŒè´¦æˆ·çš„ Token

#### ä¸ºä»€ä¹ˆéœ€è¦ä¸åŒè´¦æˆ·ï¼Ÿ
- GitHub rate limit æ˜¯æŒ‰**è´¦æˆ· ID** è®¡ç®—ï¼Œä¸æ˜¯æŒ‰ token
- åŒä¸€è´¦æˆ·çš„ 10 ä¸ª token = 1 ä¸ªè´¦æˆ·çš„é…é¢ï¼ˆ5000æ¬¡/å°æ—¶ï¼‰
- 10 ä¸ªä¸åŒè´¦æˆ·çš„ token = 10 ä¸ªè´¦æˆ·çš„é…é¢ï¼ˆ50000æ¬¡/å°æ—¶ï¼‰

#### å¦‚ä½•è·å–ä¸åŒè´¦æˆ·çš„ Tokenï¼Ÿ

**æ–¹æ¡ˆ 1: åˆ›å»ºå¤šä¸ª GitHub è´¦æˆ·ï¼ˆæ¨èï¼‰**
```bash
# æ­¥éª¤ï¼š
1. åˆ›å»º 6 ä¸ªæ–°çš„ GitHub è´¦æˆ·ï¼ˆä½¿ç”¨ä¸åŒé‚®ç®±ï¼‰
2. ä¸ºæ¯ä¸ªè´¦æˆ·ç”Ÿæˆ Personal Access Token
3. å°†è¿™äº› token æ·»åŠ åˆ° .env æ–‡ä»¶

# éœ€è¦çš„æƒé™ï¼š
- repo (å®Œæ•´æƒé™)
- read:org
- read:user
```

**æ–¹æ¡ˆ 2: ä½¿ç”¨ç»„ç»‡æˆå‘˜çš„è´¦æˆ·**
```bash
# å¦‚æœä½ åœ¨ä¸€ä¸ªç»„ç»‡ä¸­ï¼š
1. è¯·æ±‚å›¢é˜Ÿæˆå‘˜åˆ›å»º token
2. ç¡®ä¿ä»–ä»¬æœ‰ä»“åº“è®¿é—®æƒé™
3. æ”¶é›†è¿™äº› token
```

**æ–¹æ¡ˆ 3: ä½¿ç”¨ GitHub App**
```bash
# é«˜çº§æ–¹æ¡ˆï¼š
1. åˆ›å»º GitHub App
2. ä¸ºä¸åŒçš„ç»„ç»‡/ç”¨æˆ·å®‰è£…
3. ä½¿ç”¨ App Tokenï¼ˆæ›´é«˜çš„ rate limitï¼‰
```

#### æ›´æ–° .env æ–‡ä»¶
```env
# ç¡®ä¿è¿™äº› token æ¥è‡ªä¸åŒçš„ GitHub è´¦æˆ·ï¼
GITHUB_TOKEN=ghp_token_from_account_1
GITHUB_TOKEN_1=ghp_token_from_account_2
GITHUB_TOKEN_2=ghp_token_from_account_3
GITHUB_TOKEN_3=ghp_token_from_account_4
GITHUB_TOKEN_4=ghp_token_from_account_5
GITHUB_TOKEN_5=ghp_token_from_account_6
GITHUB_TOKEN_6=ghp_token_from_account_7
```

---

## ğŸ“Š å½“å‰ç³»ç»ŸçŠ¶æ€

### GraphQL èµ„æºæ¶ˆè€—ä¼°ç®—

å‡è®¾çˆ¬å–ä¸€ä¸ªä¸­å‹é¡¹ç›®ï¼ˆ113 ä¸ªæœˆçš„æ•°æ®ï¼‰ï¼š

**ä¿®æ”¹å‰ï¼ˆ100 items/è¯·æ±‚ï¼‰**:
- Issues: 113 æœˆ Ã— ~5 æ¬¡è¯·æ±‚ Ã— 100 ç‚¹ = ~56,500 ç‚¹
- PRs: 113 æœˆ Ã— ~3 æ¬¡è¯·æ±‚ Ã— 100 ç‚¹ = ~33,900 ç‚¹
- Commits: 113 æœˆ Ã— ~10 æ¬¡è¯·æ±‚ Ã— 100 ç‚¹ = ~113,000 ç‚¹
- **æ€»è®¡: ~203,400 ç‚¹** âŒ **è¿œè¶… 5000 ç‚¹/å°æ—¶é™åˆ¶**

**ä¿®æ”¹åï¼ˆ20 items/è¯·æ±‚ï¼‰**:
- Issues: 113 æœˆ Ã— ~25 æ¬¡è¯·æ±‚ Ã— 20 ç‚¹ = ~56,500 ç‚¹
- PRs: 113 æœˆ Ã— ~15 æ¬¡è¯·æ±‚ Ã— 20 ç‚¹ = ~33,900 ç‚¹
- Commits: 113 æœˆ Ã— ~50 æ¬¡è¯·æ±‚ Ã— 20 ç‚¹ = ~113,000 ç‚¹
- **æ€»è®¡: ~203,400 ç‚¹** âš ï¸ **ä»ç„¶è¶…é™**ï¼ˆè¯·æ±‚æ¬¡æ•°å¢åŠ ï¼Œä½†æ€»ç‚¹æ•°ç±»ä¼¼ï¼‰

**ä½¿ç”¨ 7 ä¸ªä¸åŒè´¦æˆ·çš„ token**:
- æ€»é…é¢: 7 Ã— 5000 = **35,000 ç‚¹/å°æ—¶**
- çˆ¬å–è¯¥é¡¹ç›®: ~203,400 ç‚¹
- **éœ€è¦æ—¶é—´: ~6 å°æ—¶**ï¼ˆåˆ†æ‰¹çˆ¬å–ï¼‰âœ… **å¯è¡Œ**

---

## ğŸ”§ ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆåœ¨è·å–æ–° Token ä¹‹å‰ï¼‰

### æ–¹æ¡ˆ A: å¤§å¹…å‡å°‘æ•°æ®é‡
ä¿®æ”¹ `monthly_crawler.py` ä¸­çš„ `max_per_month`:
```python
# ä»
max_per_month = 3  # æ¯ä¸ªæœˆæœ€å¤šçˆ¬3æ¡æ•°æ®

# æ”¹ä¸º
max_per_month = 1  # æ¯ä¸ªæœˆæœ€å¤šçˆ¬1æ¡æ•°æ®
```

### æ–¹æ¡ˆ B: åªçˆ¬å–æœ€è¿‘çš„æ•°æ®
ä¿®æ”¹è¦çˆ¬å–çš„æœˆä»½èŒƒå›´ï¼š
```python
# ä»
éœ€è¦çˆ¬å–çš„æœˆä»½æ•°: 113

# æ”¹ä¸º
åªçˆ¬å–æœ€è¿‘ 12 ä¸ªæœˆçš„æ•°æ®
```

### æ–¹æ¡ˆ C: ä½¿ç”¨ REST API æ›¿ä»£ GraphQL
- REST API çš„ rate limit æ˜¯ç‹¬ç«‹çš„ï¼ˆ5000æ¬¡/å°æ—¶ï¼‰
- ä¸ä¼šé‡åˆ° "Resource limits exceeded" é”™è¯¯
- ä½†é€Ÿåº¦ä¼šæ…¢å¾ˆå¤šï¼ˆéœ€è¦æ›´å¤šæ¬¡è¯·æ±‚ï¼‰

### æ–¹æ¡ˆ D: ç­‰å¾… Rate Limit é‡ç½®
- å½“å‰éœ€è¦ç­‰å¾…: **48 åˆ†é’Ÿ**
- æ¯å°æ—¶é‡ç½®ä¸€æ¬¡
- ä½†å¾ˆå¿«åˆä¼šè€—å°½

---

## ğŸ“ éªŒè¯ Token æ¥è‡ªä¸åŒè´¦æˆ·

è¿è¡Œè¿™ä¸ªè„šæœ¬æ£€æŸ¥ä½ çš„ tokens:

```python
import os
import requests
from dotenv import load_dotenv

load_dotenv()

tokens = [os.getenv('GITHUB_TOKEN')]
for i in range(1, 7):
    token = os.getenv(f'GITHUB_TOKEN_{i}')
    if token:
        tokens.append(token)

print(f"æ‰¾åˆ° {len(tokens)} ä¸ª tokens\n")

for idx, token in enumerate(tokens, 1):
    if not token:
        continue
    
    headers = {'Authorization': f'token {token}'}
    response = requests.get('https://api.github.com/user', headers=headers)
    
    if response.status_code == 200:
        user_data = response.json()
        print(f"Token {idx}:")
        print(f"  ç”¨æˆ·å: {user_data['login']}")
        print(f"  ç”¨æˆ·ID: {user_data['id']}")
        print(f"  è´¦æˆ·ç±»å‹: {user_data.get('type', 'N/A')}")
        
        # æ£€æŸ¥ rate limit
        rate_response = requests.get('https://api.github.com/rate_limit', headers=headers)
        if rate_response.status_code == 200:
            rate_data = rate_response.json()
            core = rate_data['resources']['core']
            graphql = rate_data['resources']['graphql']
            print(f"  REST API å‰©ä½™: {core['remaining']}/{core['limit']}")
            print(f"  GraphQL å‰©ä½™: {graphql['remaining']}/{graphql['limit']}")
        print()
    else:
        print(f"Token {idx}: æ— æ•ˆæˆ–å·²è¿‡æœŸ\n")
```

**å¦‚æœæ‰€æœ‰ token éƒ½æ˜¾ç¤ºç›¸åŒçš„ç”¨æˆ· IDï¼Œè¯´æ˜å®ƒä»¬æ¥è‡ªåŒä¸€è´¦æˆ·ï¼**

---

## ğŸ¯ è¡ŒåŠ¨è®¡åˆ’

### ç«‹å³è¡ŒåŠ¨ï¼ˆ5åˆ†é’Ÿï¼‰
1. âœ… ä»£ç é”™è¯¯å·²ä¿®å¤ï¼ˆ`import time`ï¼‰
2. âœ… GraphQL æŸ¥è¯¢é‡å·²å‡å°‘ï¼ˆ100 â†’ 20ï¼‰
3. â³ ç­‰å¾…å½“å‰ rate limit é‡ç½®ï¼ˆ48 åˆ†é’Ÿï¼‰

### çŸ­æœŸè¡ŒåŠ¨ï¼ˆä»Šå¤©ï¼‰
1. [ ] è¿è¡ŒéªŒè¯è„šæœ¬ï¼Œç¡®è®¤æ‰€æœ‰ token çš„è´¦æˆ· ID
2. [ ] å¦‚æœéƒ½æ˜¯åŒä¸€è´¦æˆ·ï¼Œæš‚æ—¶é™ä½çˆ¬å–æ•°æ®é‡
3. [ ] æˆ–è€…ï¼Œåªçˆ¬å–æœ€è¿‘ 12 ä¸ªæœˆçš„æ•°æ®

### ä¸­æœŸè¡ŒåŠ¨ï¼ˆæœ¬å‘¨ï¼‰
1. [ ] åˆ›å»º 6 ä¸ªæ–°çš„ GitHub è´¦æˆ·
2. [ ] ä¸ºæ¯ä¸ªè´¦æˆ·ç”Ÿæˆ token
3. [ ] æ›´æ–° `.env` æ–‡ä»¶
4. [ ] å†æ¬¡è¿è¡ŒéªŒè¯è„šæœ¬ï¼Œç¡®è®¤ 7 ä¸ªä¸åŒçš„ç”¨æˆ· ID

### é•¿æœŸè¡ŒåŠ¨ï¼ˆå¯é€‰ï¼‰
1. [ ] è€ƒè™‘ä½¿ç”¨ GitHub Appï¼ˆæ›´é«˜çš„ rate limitï¼‰
2. [ ] å®ç°æ™ºèƒ½ç¼“å­˜æœºåˆ¶
3. [ ] ä½¿ç”¨ OpenDigger API ä»£æ›¿ GitHub APIï¼ˆå¯¹äºå·²æœ‰çš„æŒ‡æ ‡ï¼‰

---

## ğŸ” å¦‚ä½•çŸ¥é“ä¿®å¤æ˜¯å¦æœ‰æ•ˆï¼Ÿ

### æˆåŠŸçš„æ ‡å¿—ï¼š
- âœ… ä¸å†çœ‹åˆ° "Resource limits for this query exceeded"
- âœ… çœ‹åˆ°ä¸åŒçš„ç”¨æˆ· ID åœ¨æ—¥å¿—ä¸­è½®æ¢
- âœ… çˆ¬å–è¿‡ç¨‹æ›´ç¨³å®šï¼Œä¸é¢‘ç¹ä¸­æ–­
- âœ… Rate limit é‡ç½®åå¯ä»¥ç»§ç»­çˆ¬å–

### ä»æœ‰é—®é¢˜çš„æ ‡å¿—ï¼š
- âŒ ä»ç„¶çœ‹åˆ° "API rate limit already exceeded for user ID 181187014"
- âŒ æ‰€æœ‰ token éƒ½å¿«é€Ÿè€—å°½
- âŒ éœ€è¦ç­‰å¾…å¾ˆé•¿æ—¶é—´

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœä½ ï¼š
- æ— æ³•åˆ›å»ºå¤šä¸ª GitHub è´¦æˆ·
- éœ€è¦å…¶ä»–è§£å†³æ–¹æ¡ˆ
- é‡åˆ°å…¶ä»–é”™è¯¯

è¯·æä¾›ï¼š
1. éªŒè¯è„šæœ¬çš„è¾“å‡ºï¼ˆç”¨æˆ· ID å’Œå‰©ä½™é…é¢ï¼‰
2. åç«¯æ—¥å¿—çš„æœ€æ–°éƒ¨åˆ†
3. ä½ çš„å…·ä½“éœ€æ±‚ï¼ˆéœ€è¦çˆ¬å–å¤šå°‘æ•°æ®ï¼Ÿï¼‰

---

**æ›´æ–°æ—¶é—´**: 2025-12-13
**çŠ¶æ€**: ğŸ”„ ä»£ç å·²ä¿®å¤ï¼Œç­‰å¾…éªŒè¯ Token è´¦æˆ·




